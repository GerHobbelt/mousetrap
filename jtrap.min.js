if(!("contains"in String.prototype))String.prototype.contains=function(e,t){return-1!==this.indexOf(e,t)};(function(e,t,n){function v(e){if(e.type=="keypress"){var t=String.fromCharCode(e.which);if(!e.shiftKey){t=t.toLowerCase()}return t}if(r[e.which]){return r[e.which]}if(i[e.which]){return i[e.which]}return String.fromCharCode(e.which).toLowerCase()}function m(e,t){return e.sort().join(",")===t.sort().join(",")}function g(e){e=e||{};var t=false,n;for(n in f){if(e[n]){t=true;continue}f[n]=0}if(!t){p=false}}function y(e,t,n,r,i,s){var o,u,l=[],c=n.type;if(!a[e]){return[]}if(c=="keyup"&&S(e)){t=[e]}for(o=0;o<a[e].length;++o){u=a[e][o];if(!r&&u.seq&&f[u.seq]!=u.level){continue}if(c!=u.action){continue}if(c=="keypress"&&!n.metaKey&&!n.ctrlKey||m(t,u.modifiers)){var h=!r&&u.combo==i;var p=r&&u.seq==r&&u.level==s;if(h||p){a[e].splice(o,1)}l.push(u)}}return l}function b(e){var t=[];if(e.shiftKey){t.push("shift")}if(e.altKey){t.push("alt")}if(e.ctrlKey){t.push("ctrl")}if(e.metaKey){t.push("meta")}return t}function w(e,t,n,r){if(O.stopCallback(t,t.target||t.srcElement,n,r)){return}if(e(t,n)===false){if(t.preventDefault){t.preventDefault()}if(t.stopPropagation){t.stopPropagation()}t.returnValue=false;t.cancelBubble=true}}function E(e,t,n){var r=y(e,t,n),i,s={},o=0,u=false;for(i=0;i<r.length;++i){if(r[i].seq){o=Math.max(o,r[i].level)}}for(i=0;i<r.length;++i){if(r[i].seq){if(r[i].level!=o){continue}u=true;s[r[i].seq]=1;w(r[i].callback,n,r[i].combo,r[i].seq);continue}if(!u){w(r[i].callback,n,r[i].combo)}}var a=n.type=="keypress"&&h;if(n.type==p&&!S(e)&&!a){g(s)}h=u&&n.type=="keydown"}function S(e){return e=="shift"||e=="ctrl"||e=="alt"||e=="meta"}function x(){if(!u){u={};for(var e in r){if(e>95&&e<112){continue}if(r.hasOwnProperty(e)){u[r[e]]=e}}}return u}function T(e,t,n){if(!n){throw"Pick best action inner not programmed.";n=x()[e]?"keydown":"keypress"}if(n.contains("keypress")&&t.length){n=n.replace("keypress","keydown","gi")}return n}function N(e,t){var n=[];if(t&&!t.contains("keypress")&&s[e]){e=s[e];n.push("shift")}t=T(e,n,t);return{key:e,modifiers:n,action:t}}function C(e,t,n){var r;r=N(e,n);k({callback:t,modifiers:r.modifiers,action:r.action,key:e})}function k(t){$(e).on(t.action,function(e){if(typeof e.which!=="number"){e.which=e.keyCode}var n=v(e);if(!n){return}if(n==t.key){t.callback(e)}})}function L(e,t){var n;n=N(e,t);A({modifiers:n.modifiers,action:n.action,key:e})}function A(t){$(e).off(t.action)}var r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},i={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},o={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},u,a={},f={},l,c=false,h=false,p=false;for(var d=1;d<20;++d){r[111+d]="f"+d}for(d=0;d<=9;++d){r[d+96]=d}var O={bind:function(e,t,n){C(e,n,t)},unbind:function(e,t){L(e,t)},handleKey:E};e.jTrap=O;if(typeof define==="function"&&define.amd){define(jTrap)}})(window,document)