if(!("contains" in String.prototype)){String.prototype.contains=function(b,a){return -1!==this.indexOf(b,a)}}(function(k,r,f){var c={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},j={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},D={"~":"`","!":"1","@":"2","#":"3","$":"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},v={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},E,h={},A={},F,w=false,a=false,x=false;for(var z=1;z<20;++z){c[111+z]="f"+z}for(z=0;z<=9;++z){c[z+96]=z}function B(G){if(G.type=="keypress"){var i=String.fromCharCode(G.which);if(!G.shiftKey){i=i.toLowerCase()}return i}if(c[G.which]){return c[G.which]}if(j[G.which]){return j[G.which]}return String.fromCharCode(G.which).toLowerCase()}function m(G,i){return G.sort().join(",")===i.sort().join(",")}function b(i){i=i||{};var H=false,G;for(G in A){if(i[G]){H=true;continue}A[G]=0}if(!H){x=false}}function s(L,P,M,R,N,G){var J,Q,K=[],H=M.type;if(!h[L]){return[]}if(H=="keyup"&&u(L)){P=[L]}for(J=0;J<h[L].length;++J){Q=h[L][J];if(!R&&Q.seq&&A[Q.seq]!=Q.level){continue}if(H!=Q.action){continue}if((H=="keypress"&&!M.metaKey&&!M.ctrlKey)||m(P,Q.modifiers)){var O=!R&&Q.combo==N;var I=R&&Q.seq==R&&Q.level==G;if(O||I){h[L].splice(J,1)}K.push(Q)}}return K}function e(G){var i=[];if(G.shiftKey){i.push("shift")}if(G.altKey){i.push("alt")}if(G.ctrlKey){i.push("ctrl")}if(G.metaKey){i.push("meta")}return i}function p(I,G,i,H){if(g.stopCallback(G,G.target||G.srcElement,i,H)){return}if(I(G,i)===false){if(G.preventDefault){G.preventDefault()}if(G.stopPropagation){G.stopPropagation()}G.returnValue=false;G.cancelBubble=true}}function C(K,N,L){var M=s(K,N,L),I,H={},O=0,J=false;for(I=0;I<M.length;++I){if(M[I].seq){O=Math.max(O,M[I].level)}}for(I=0;I<M.length;++I){if(M[I].seq){if(M[I].level!=O){continue}J=true;H[M[I].seq]=1;p(M[I].callback,L,M[I].combo,M[I].seq);continue}if(!J){p(M[I].callback,L,M[I].combo)}}var G=L.type=="keypress"&&a;if(L.type==x&&!u(K)&&!G){b(H)}a=J&&L.type=="keydown"}function u(i){return i=="shift"||i=="ctrl"||i=="alt"||i=="meta"}function d(){if(!E){E={};for(var i in c){if(i>95&&i<112){continue}if(c.hasOwnProperty(i)){E[c[i]]=i}}}return E}function t(G,i,H){if(!H){throw"Pick best action inner not programmed.";H=d()[G]?"keydown":"keypress"}if(H.contains("keypress")&&i.length){H=H.replace("keypress","keydown","gi")}return H}function y(G,H){var i=[];if(H&&!H.contains("keypress")&&D[G]){G=D[G];i.push("shift")}H=t(G,i,H);return{key:G,modifiers:i,action:H}}function o(i,I,G){var H;H=y(i,G);l({callback:I,modifiers:H.modifiers,action:H.action,key:i})}function l(i){$(k).on(i.action,function(H){if(typeof H.which!=="number"){H.which=H.keyCode}var G=B(H);if(!G){return}if(G==i.key){i.callback()}})}function q(i,G){var H;H=y(i,G);n({modifiers:H.modifiers,action:H.action,key:i})}function n(i){$(k).off(i.action)}var g={bind:function(i,G,H){o(i,H,G)},unbind:function(i,G){q(i,G)},handleKey:C};k.jTrap=g;if(typeof define==="function"&&define.amd){define(jTrap)}})(window,document);